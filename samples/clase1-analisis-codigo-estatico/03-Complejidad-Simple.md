# EJERCICIO 3: Complejidad de C√≥digo - Gu√≠a para Principiantes

## ¬øQu√© es la Complejidad de C√≥digo?

**Complejidad** = ¬øQu√© tan dif√≠cil es entender tu c√≥digo?

### Ejemplo f√°cil:
```csharp
// SIMPLE (Complejidad = 1)
public void Saludar()
{
    Console.WriteLine("Hola!");
}

// COMPLICADO (Complejidad = 5)
public void SaludarConCondiciones(string nombre, bool esMa√±ana, bool esVip)
{
    if (nombre != null)
    {
        if (esMa√±ana)
        {
            if (esVip)
            {
                Console.WriteLine($"Buenos d√≠as, estimado {nombre}!");
            }
            else
            {
                Console.WriteLine($"Buenos d√≠as, {nombre}!");
            }
        }
        else
        {
            Console.WriteLine($"Hola {nombre}!");
        }
    }
}
```

---

## ¬øPor qu√© importa la Complejidad?

### C√≥digo simple:
‚úÖ **F√°cil de leer** - Cualquiera lo entiende r√°pido  
‚úÖ **F√°cil de probar** - Pocos casos de prueba  
‚úÖ **F√°cil de mantener** - Cambios simples y r√°pidos  
‚úÖ **Menos bugs** - Menos lugares donde pueden ocurrir errores  

### C√≥digo complejo:
‚ùå **Dif√≠cil de leer** - Necesitas tiempo para entenderlo  
‚ùå **Dif√≠cil de probar** - Muchos casos de prueba  
‚ùå **Dif√≠cil de mantener** - Cambios riesgosos  
‚ùå **M√°s bugs** - Muchos lugares donde pueden fallar  

---

## Complejidad Ciclom√°tica Explicada Simple

### ¬øQu√© es?
Es un **n√∫mero** que te dice cu√°ntos **caminos diferentes** puede tomar tu c√≥digo.

### ¬øC√≥mo se calcula?
**Empieza con 1** y suma 1 por cada:
- `if`
- `else if`
- `while`
- `for`
- `foreach`
- `switch` (cada `case`)
- `&&` (and)
- `||` (or)
- `?` (operador ternario)

### Ejemplo paso a paso:
```csharp
public bool PuedeComprar(int edad, decimal dinero, bool tieneId)
{
    // Empezamos con 1
    
    if (edad >= 18)          // +1 = 2
    {
        if (dinero > 100)    // +1 = 3
        {
            if (tieneId)     // +1 = 4
            {
                return true;
            }
        }
    }
    return false;
}
// Complejidad Total = 4
```

---

## Escala de Complejidad

| Complejidad | Nivel | Qu√© significa |
|-------------|-------|---------------|
| 1-5 | üü¢ **F√°cil** | C√≥digo simple, f√°cil de entender |
| 6-10 | üü° **Moderado** | C√≥digo aceptable, pero puedes mejorarlo |
| 11-15 | üü† **Complicado** | C√≥digo dif√≠cil, necesita refactoring |
| 16+ | üî¥ **Muy complicado** | C√≥digo muy dif√≠cil, urgente refactoring |

---

## Ejercicio Pr√°ctico: Medir Complejidad

### Paso 1: C√≥digo para analizar
Crea un archivo `ComplejidadEjemplo.cs`:

```csharp
using System;

public class ComplejidadEjemplo
{
    // M√âTODO 1: Calcula tu complejidad
    public string ClasificarEdad(int edad)
    {
        if (edad < 13)
        {
            return "Ni√±o";
        }
        else if (edad < 18)
        {
            return "Adolescente";
        }
        else if (edad < 65)
        {
            return "Adulto";
        }
        else
        {
            return "Adulto Mayor";
        }
    }
    
    // M√âTODO 2: Calcula tu complejidad
    public bool PuedeConducir(int edad, bool tieneLicencia, bool tieneAnteojos, bool necesitaAnteojos)
    {
        if (edad >= 18)
        {
            if (tieneLicencia)
            {
                if (necesitaAnteojos)
                {
                    if (tieneAnteojos)
                    {
                        return true;
                    }
                }
                else
                {
                    return true;
                }
            }
        }
        return false;
    }
    
    // M√âTODO 3: Calcula tu complejidad
    public decimal CalcularDescuento(decimal precio, string tipoCliente, bool esFinDeSemana)
    {
        decimal descuento = 0;
        
        if (tipoCliente == "VIP")
        {
            descuento = 0.20m;
        }
        else if (tipoCliente == "Premium")
        {
            descuento = 0.15m;
        }
        else if (tipoCliente == "Regular")
        {
            descuento = 0.10m;
        }
        
        if (esFinDeSemana && descuento > 0)
        {
            descuento += 0.05m;
        }
        
        return precio * descuento;
    }
}
```

### Paso 2: Calcular complejidad manualmente
Para cada m√©todo, cuenta:
1. **Empezar con 1**
2. **Sumar 1** por cada `if`, `else if`, `&&`, `||`
3. **Anotar el total**

**Tus respuestas:**
- `ClasificarEdad`: ____
- `PuedeConducir`: ____
- `CalcularDescuento`: ____

### Paso 3: Verificar con Visual Studio
1. **Compilar** el proyecto
2. **Ir a** Analyze ‚Üí Calculate Code Metrics
3. **Comparar** tus c√°lculos con los resultados

---

## T√©cnicas para Reducir Complejidad

### 1. Guard Clauses (Validaciones tempranas)

**‚ùå Antes (Complejidad = 4):**
```csharp
public void ProcesarUsuario(string nombre, int edad)
{
    if (nombre != null)
    {
        if (edad > 0)
        {
            if (edad < 120)
            {
                Console.WriteLine($"Procesando {nombre}, edad {edad}");
            }
        }
    }
}
```

**‚úÖ Despu√©s (Complejidad = 1):**
```csharp
public void ProcesarUsuario(string nombre, int edad)
{
    if (nombre == null) return;
    if (edad <= 0) return;
    if (edad >= 120) return;
    
    Console.WriteLine($"Procesando {nombre}, edad {edad}");
}
```

### 2. Extraer M√©todos

**‚ùå Antes (Complejidad = 8):**
```csharp
public bool PuedeComprar(int edad, decimal dinero, bool tieneId, string producto)
{
    if (edad >= 18)
    {
        if (dinero > 50)
        {
            if (tieneId)
            {
                if (producto == "alcohol" || producto == "tabaco")
                {
                    if (edad >= 21)
                    {
                        return true;
                    }
                }
                else
                {
                    return true;
                }
            }
        }
    }
    return false;
}
```

**‚úÖ Despu√©s (Complejidad = 2 + 2 = 4 total):**
```csharp
public bool PuedeComprar(int edad, decimal dinero, bool tieneId, string producto)
{
    if (!CumpleRequisitosBasicos(edad, dinero, tieneId))
        return false;
    
    return PuedeComprarProducto(edad, producto);
}

private bool CumpleRequisitosBasicos(int edad, decimal dinero, bool tieneId) // Complejidad = 2
{
    return edad >= 18 && dinero > 50 && tieneId;
}

private bool PuedeComprarProducto(int edad, string producto) // Complejidad = 2
{
    if (producto == "alcohol" || producto == "tabaco")
    {
        return edad >= 21;
    }
    return true;
}
```

### 3. Usar Switch en lugar de m√∫ltiples if

**‚ùå Antes (Complejidad = 4):**
```csharp
public string ObtenerDiaSemana(int dia)
{
    if (dia == 1)
        return "Lunes";
    else if (dia == 2)
        return "Martes";
    else if (dia == 3)
        return "Mi√©rcoles";
    else
        return "Desconocido";
}
```

**‚úÖ Despu√©s (Complejidad = 4, pero m√°s claro):**
```csharp
public string ObtenerDiaSemana(int dia)
{
    return dia switch
    {
        1 => "Lunes",
        2 => "Martes",
        3 => "Mi√©rcoles",
        _ => "Desconocido"
    };
}
```

---

## Ejercicio de Refactoring

### C√≥digo a mejorar:
```csharp
public class SistemaCalificaciones
{
    public string CalcularCalificacion(int puntos, bool esExamen, bool entregaATiempo, 
                                     bool participaEnClase, int faltas)
    {
        if (puntos >= 0 && puntos <= 100)
        {
            if (esExamen)
            {
                if (puntos >= 90)
                {
                    if (entregaATiempo)
                    {
                        return "A+";
                    }
                    else
                    {
                        return "A";
                    }
                }
                else if (puntos >= 80)
                {
                    if (participaEnClase && faltas < 3)
                    {
                        return "B+";
                    }
                    else
                    {
                        return "B";
                    }
                }
                else if (puntos >= 70)
                {
                    if (faltas < 5)
                    {
                        return "C";
                    }
                    else
                    {
                        return "D";
                    }
                }
                else
                {
                    return "F";
                }
            }
            else
            {
                if (puntos >= 85)
                {
                    return "A";
                }
                else if (puntos >= 70)
                {
                    return "B";
                }
                else if (puntos >= 60)
                {
                    return "C";
                }
                else
                {
                    return "F";
                }
            }
        }
        return "Error";
    }
}
```

### Tu tarea:
1. **Calcula** la complejidad actual
2. **Identifica** qu√© hace el c√≥digo
3. **Refactoriza** usando las t√©cnicas aprendidas
4. **Verifica** que la complejidad sea menor

### Pistas para mejorar:
- Usa **Guard Clauses** para validaciones
- **Extrae m√©todos** para casos espec√≠ficos
- **Simplifica** las condiciones anidadas

---

## Herramientas para Medir Complejidad

### En Visual Studio:
1. **Analyze** ‚Üí **Calculate Code Metrics**
2. **Resultados** en ventana Code Metrics
3. **Ordenar** por complejidad ciclom√°tica

### Extensiones √∫tiles:
- **SonarLint**: Marca m√©todos complejos
- **Code Metrics**: An√°lisis en tiempo real
- **Refactoring Tools**: Ayuda con mejoras

### M√©tricas importantes:
- **Complejidad Ciclom√°tica**: < 10 por m√©todo
- **L√≠neas de c√≥digo**: < 50 por m√©todo
- **N√∫mero de par√°metros**: < 5 por m√©todo

---

## Consejos Pr√°cticos

### Para principiantes:
1. **Empieza simple**: M√©todos que hagan una sola cosa
2. **Cuenta los if**: Si tienes m√°s de 3-4, considera refactoring
3. **Preg√∫ntate**: ¬øPuedo explicar este m√©todo en una oraci√≥n?
4. **Divide y conquista**: M√©todos grandes en m√©todos peque√±os

### Reglas de oro:
- **Un m√©todo = una responsabilidad**
- **M√°ximo 3 niveles de anidaci√≥n**
- **Si usas "y" al describir un m√©todo, probablemente haga demasiado**
- **Los nombres deben ser claros y espec√≠ficos**

### Cu√°ndo refactorizar:
- **Complejidad > 10**: Urgente
- **Complejidad 6-10**: Cuando tengas tiempo
- **M√©todo > 50 l√≠neas**: Muy probable que est√© haciendo demasiado
- **Dif√≠cil de testear**: Se√±al de alta complejidad

---

## Ejercicio Final

### Crea tu propio an√°lisis:
1. **Toma** un m√©todo que hayas escrito recientemente
2. **Calcula** su complejidad ciclom√°tica
3. **Identifica** oportunidades de mejora
4. **Refactoriza** usando las t√©cnicas aprendidas
5. **Mide** nuevamente y compara

### Reflexiona:
- ¬øEl c√≥digo mejorado es m√°s f√°cil de entender?
- ¬øSer√≠a m√°s f√°cil de probar?
- ¬øOtro desarrollador lo entender√≠a r√°pidamente?

---

**¬°Felicitaciones!** üéâ Ya sabes medir y mejorar la complejidad de tu c√≥digo.

**Siguiente ejercicio**: Crear un checklist de calidad para todos tus proyectos.